{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "Location": {
            "type": "string",
            "defaultValue": "westeurope",
            "allowedValues": [
                "westeurope",
                "northeurope"
            ],
            "metadata": {
                "description": "The name of for the Storage Account to be created."
            }
        },
        "ResourceGroup":{
            "type":"string",
            "defaultValue": "AZ-RG-TAKETEST",
            "metadata": {
                "description": "The name for the ResourceGroup"
            }
        },
        "StorageAccountName": {
            "type": "string",
            "defaultValue": "azsataketest",
            "metadata": {
                "description": "The name of for the Storage Account to be created."
            }
        },
        "VNetName":{
            "type":"string",
            "defaultValue": "AZ-VNET-TAKETEST",
            "metadata": {
                "description": "The name for the Virtual Network"
            }
        },
        "VNetAddressPrefix": {
            "type": "string",
            "defaultValue": "192.168.0.0/16",
            "metadata": {
                "description": "The network prefix in IP4 notation. For example 10.0.0.0/16"
            }
        },
        "SubnetName": {
            "type": "string",
            "defaultValue": "AZ-SN-TAKETEST",
            "metadata": {
                "description": "The name of for the subnet to be created."
            }
        },
        "SubnetPrefix": {
            "type": "string",
            "defaultValue": "192.168.100.0/24",
            "metadata": {
                "description": "The Subnet prefix in IP4 notation. For example 10.0.1.0/24"
            }
        },
        "LoadBalancerName": {
            "type": "string",
            "defaultValue": "TakeTest",
            "metadata": {
                "description": "The Name for the loadbalancer to be deployed"
            }
        },
        "WebAppName": {
            "type": "string",
            "defaultValue": "AZ-WA-TAKETEST"
        },
        "WebAppSku": {
            "type": "string",
            "defaultValue": "S1"
        },
        "StorageAccountSku": {
            "type": "string",
            "defaultValue": "Standard_LRS"
        },
        "StorageAccountKind": {
            "type": "string",
            "defaultValue": "StorageV2"
        },
        "AccessTier": {
            "type": "string",
            "defaultValue": "Hot"
        },
        "KeyVaultName": {
            "type": "string",
            "defaultValue": "AZ-KV-TAKETEST"
        },
        "KeyVaultSku": {
            "type": "string",
            "defaultValue": "Standard",
            "allowedValues": [
              "Standard",
              "Premium"
            ],
        },
        "EnabledForDeployment": {
            "type": "bool",
            "defaultValue": false,
            "allowedValues": [
              true,
              false
            ],
        },
        "EnabledForDiskEncryption": {
            "type": "bool",
            "defaultValue": false,
            "allowedValues": [
              true,
              false
            ],
        },
        "EnabledForTemplateDeployment": {
            "type": "bool",
            "defaultValue": false,
            "allowedValues": [
              true,
              false
            ],
        },
        "ObjectId": {
            "type": "string",
            "defaultValue": "AZ-KV-TAKETEST",
            "metadata": {
                "description": "Specifies the object ID of a user, service principal or security group in the Azure Active Directory tenant for the vault. The object ID must be unique for the list of access policies. Get it by using Get-AzADUser or Get-AzADServicePrincipal cmdlets."
              }
        },
        "SecretName": {
            "type": "string",
            "defaultValue": "SentiaSecret",
            "metadata": {
              "description": "Specifies the name of the secret that you want to create."
            }
        },
        "SecretValue": {
            "type": "securestring",
            "defaultValue": "HelloSentia",
            "metadata": {
              "description": "Specifies the value of the secret that you want to create."
            }
        },
        "KeysPermissions": {
            "type": "array",
            "defaultValue": [
              "list"
            ],
            "metadata": {
              "description": "Specifies the permissions to keys in the vault. Valid values are: all, encrypt, decrypt, wrapKey, unwrapKey, sign, verify, get, list, create, update, import, delete, backup, restore, recover, and purge."
            }
        },
        "SecretsPermissions": {
            "type": "array",
            "defaultValue": [
              "list"
            ],
            "metadata": {
              "description": "Specifies the permissions to secrets in the vault. Valid values are: all, get, list, set, delete, backup, restore, recover, and purge."
            }
        }
    },
    "variables": {
        "ResourceGroupTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-ResourceGroup.JSON",
        "VNetTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-Vnet.JSON",
        "LBTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-LB.JSON",
        "KeyVaultTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-KeyVault.JSON",
        "StorageAccountTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-StorageAccount.JSON",
        "WebAppTemplate": "https://raw.githubusercontent.com/iam-take/Public/master/Deploy-WebApp.JSON", 
        "DeployVersion": "1.0.0.0"
    },
    "resources": [
        {
            "apiVersion": "2015-01-01",
            "name": "VNetTemplate",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "incremental",
                "templateLink": {
                    "uri": "[variables('VNetTemplate')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "VNetName": {
                        "value": "[parameters('VNetName')]"
                    },
                    "VNetAddressPrefix":{
                        "value": "[parameters('VNetAddressPrefix')]"
                    },
                    "SubnetName": {
                        "value": "[parameters('SubnetName')]"
                    },
                    "SubnetPrefix": {
                        "value": "[parameters('SubnetPrefix')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    }
                }
            }
        },
        {
            "apiVersion": "2015-01-01",
            "name": "LBTemplate",
            "type": "Microsoft.Resources/deployments",
            "dependsOn": [
                "VNetTemplate"
            ],
            "properties": {
                "mode": "incremental",
                "templateLink": {
                    "uri": "[variables('LBTemplate')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "LoadBalancerName": {
                        "value": "[parameters('LoadBalancerName')]"
                    },
                    "VNetName": {
                        "value": "[parameters('VNetName')]"
                    },
                    "SubnetName": {
                        "value": "[parameters('SubnetName')]"
                    },
                    "location": {
                        "value": "[parameters('location')]"
                    }
                }
            }
        },
        {
            "apiVersion": "2015-01-01",
            "name": "WebAppTemplate",
            "type": "Microsoft.Resources/deployments",
            "dependsOn": [
                "LBTemplate"
            ],
            "properties": {
                "mode": "incremental",
                "templateLink": {
                    "uri": "[variables('WebAppTemplate')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "Location": {
                        "value": "[parameters('Location')]"
                    },
                    "WebAppSku": {
                        "value": "[parameters('WebAppSku')]"
                    },
                    "WebAppName": {
                        "value": "[parameters('WebAppName')]"
                    },
                    "LoadBalancerName": {
                        "value": "[parameters('LoadBalancerName')]"
                    }
                }
            }
        },
        {
            "apiVersion": "2015-01-01",
            "name": "StorageAccountTemplate",
            "type": "Microsoft.Resources/deployments",
            "dependsOn": [],
            "properties": {
                "mode": "incremental",
                "templateLink": {
                    "uri": "[variables('StorageAccountTemplate')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "Location": {
                        "value": "[parameters('Location')]"
                    },
                    "StorageAccountName": {
                        "value": "[parameters('StorageAccountName')]"
                    },
                    "AccessTier": {
                        "value": "[parameters('AccessTier')]"
                    },
                    "StorageAccountSku": {
                        "value": "[parameters('StorageAccountSku')]"
                    },
                    "StorageAccountKind": {
                        "value": "[parameters('StorageAccountKind')]"
                    }
                }
            }
        },
        {
            "apiVersion": "2015-01-01",
            "name": "KeyVaultTemplate",
            "type": "Microsoft.Resources/deployments",
            "dependsOn": [],
            "properties": {
                "mode": "incremental",
                "templateLink": {
                    "uri": "[variables('KeyVaultTemplate')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "Location": {
                        "value": "[parameters('Location')]"
                    },
                    "KeyVaultName": {
                        "value": "[parameters('KeyVaultName')]"
                    },
                    "EnabledForDeployment": {
                        "value": "[parameters('EnabledForDeployment')]"
                    },
                    "EnabledForDiskEncryption": {
                        "value": "[parameters('EnabledForDiskEncryption')]"
                    },
                    "EnabledForTemplateDeployment": {
                        "value": "[parameters('EnabledForTemplateDeployment')]"
                    },
                    "ObjectId": {
                        "value": "[parameters('ObjectId')]"
                    },
                    "KeysPermissions": {
                        "value": "[parameters('KeysPermissions')]"
                    },
                    "SecretsPermissions": {
                        "value": "[parameters('SecretsPermissions')]"
                    },
                    "SecretName": {
                        "value": "[parameters('SecretName')]"
                    },
                    "SecretValue": {
                        "value": "[parameters('SecretValue')]"
                    },
                    "KeyVaultSku": {
                        "value": "[parameters('KeyVaultSku')]"
                    }
                }
            }
        }
    ],
    "outputs": {}
}